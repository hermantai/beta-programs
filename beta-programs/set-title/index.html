<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8" />
<title>Set Title</title>
</head>
<body>
  <p>
    This simple page is to let you set the title of the page, so that when
    this window is minimized in the dock (as in Mac), the title shows up when
    you hover the app. This is most useful if you use multiple tabs in a web
    browser, you then minimize the window containing the tabs, and you want to
    know what the tabs in the window are about when you hover the app.
  </p>
  <p>
    My use case is that I often group multiple related bookmarks for a project
    (think of a project as a task that I want to work on which requires some
    researching, Google doc writing, etc) into a folder. Then, when I work on
    that project, I use the "Open All Bookmarks in New Window" feature in the
    web browser. Most of the time, I work on several projects at a time. I
    like to minimize windows that I don't need, and the hover feature let me
    switch to a specific "project window" easily. Besides, I can set the title
    to include some status of the project, so I can back my context when I
    switch between projects.
  </p>
  <form>
    <div>
      <label for="set-title-input">Set Title</label>
      <input
          type="text"
          id="set-title-input"
          name="set-title-input"
          placeholder="Enter title here" />
          <button id="set-title-button">Set</button>
    </div>
    <div>
      <label for="display-title-input">Current Title</label>
      <input
          type="text"
          id="display-title-input"
          name="display-title-input"
          disabled="disabled" />
    </div>
  </form>

  <script>
    function getParams() {
      // found in http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
      var match,
          pl     = /\+/g,  // Regex for replacing addition symbol with a space
          search = /([^&=]+)=?([^&]*)/g,
          decode = function (s) {
            return decodeURIComponent(s.replace(pl, " "));
          },
          query  = window.location.search.substring(1);

      var urlParams = {};
      while ((match = search.exec(query)) !== null) {
         urlParams[decode(match[1])] = decode(match[2]);
      }
      return urlParams;
    }

    function setPageTitle(newTitle) {
      var displayTitleInput = document.getElementById('display-title-input');
      document.title = newTitle;
      displayTitleInput.value = newTitle;
    }

    function getLocationFromTitle(title) {
      return window.location.pathname + "?title=" + encodeURIComponent(title);
    }

    window.onload = function (e) {
      var urlParams = getParams();
      if (urlParams.title !== undefined) {
        var currentTitle = urlParams.title;
        setPageTitle(currentTitle);
        // Set the state for this initial page, so we can set the title back
        // later (in window.popstate event) if the user uses the "back" button
        // to come back to this page.
        // Note that we use replaceState, because when the user goes to this
        // page with title "ABC", pressing the "back" button should not stay
        // at this page (this "Set Title" web app). He/she should go back to
        // whatever page he/she was browsing.
        window.history.replaceState(
          {title: currentTitle},  // the state is used for window.popstate
                                  // event
          currentTitle
          /* we don't pass a new url here */
        );
      }

      var setTitleInput = document.getElementById('set-title-input');
      var setTitleButton = document.getElementById('set-title-button');
      setTitleButton.addEventListener(
        "click",
        function(e) {
          e.preventDefault();

          var newTitle = setTitleInput.value;
          setPageTitle(newTitle);

          window.history.pushState(
            {title: newTitle},  // the state is used for window.popstate event
            newTitle,
            getLocationFromTitle(newTitle)
          );
        }
      );
      // When the user presses the back and forward button, the page does not
      // reload, so we need to know the previous state and set the page
      // accordingly.
      window.addEventListener(
        'popstate',
        function(e) {
          var state = e.state;

          var originalTitle = "Set Title";
          if (state !== null) {
            originalTitle = state.title;
          }
          setPageTitle(originalTitle);
        }
      );

      setTitleInput.focus();
    }
  </script>
</body>
</html>

